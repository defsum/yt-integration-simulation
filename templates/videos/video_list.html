{% extends 'base.html' %}

{% block title %}Videos - YT Integration Simulation{% endblock %}

{% block content %}
<div class="filters">
    <form method="GET" class="filters-row">
        <div class="form-group" style="flex: 1;">
            <label for="search">Search Videos</label>
            <input type="text" 
                   id="search" 
                   name="search" 
                   class="form-control" 
                   placeholder="Search by title, description or channel"
                   value="{{ search_query }}">
        </div>
        
        <div class="form-group" style="flex: 0 0 200px;">
            <label for="category">Category</label>
            <select id="category" name="category" class="form-control">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" 
                            {% if current_category == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group" style="flex: 0 0 auto;">
            <button type="submit" class="btn">Filter</button>
            {% if search_query or current_category %}
                <a href="?" class="btn btn-secondary">Clear</a>
            {% endif %}
        </div>
    </form>
    
    <div class="mt-2">
        <span class="badge badge-info">{{ total_videos }} videos found</span>
        {% if search_query %}
            <span class="badge badge-warning">Search: "{{ search_query }}"</span>
        {% endif %}
        {% if current_category %}
            {% for category in categories %}
                {% if category.id|stringformat:"s" == current_category %}
                    <span class="badge badge-success">Category: {{ category.name }}</span>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
</div>

{% if videos %}
    <div class="video-grid">
        {% for video in videos %}
            <div class="video-card card">
                <div class="video-thumbnail">
                    <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop" 
                         alt="{{ video.title }}"
                         style="width: 100%; height: 200px; object-fit: cover;">
                    <div class="duration-badge">{{ video.duration_formatted }}</div>
                </div>
                
                <div class="video-info">
                    <h3 class="video-title">
                        <a href="/videos/{{ video.id }}/">{{ video.title }}</a>
                    </h3>
                    
                    <div class="video-meta">
                        <div class="channel-info">
                            <img src="https://images.unsplash.com/photo-1559839734-2b71ea197ec2?q=80&w=1740&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" 
                                 alt="{{ video.channel_name }}"
                                 class="channel-avatar">
                            <span class="channel-name">{{ video.channel_name }}</span>
                        </div>
                        
                        <div class="video-stats">
                            <span class="stat">
                                {{ video.view_count|floatformat:"0" }} views
                            </span>
                            <span class="stat">
                                üëç {{ video.like_count }}
                            </span>
                            <span class="stat">
                                {{ video.total_comments }} comments
                            </span>
                        </div>
                        
                        <div class="video-badges">
                            {% if video.category %}
                                <span class="badge">{{ video.category.name }}</span>
                            {% endif %}
                        </div>
                        
                        <div class="published-date text-muted">
                            Published {{ video.published_at|timesince }} ago
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if videos.has_other_pages %}
        <div class="pagination">
            {% if videos.has_previous %}
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" class="page-link">¬´ First</a>
                <a href="?page={{ videos.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" class="page-link">‚Äπ Prev</a>
            {% endif %}
            
            <span class="page-link current">
                Page {{ videos.number }} of {{ videos.paginator.num_pages }}
            </span>
            
            {% if videos.has_next %}
                <a href="?page={{ videos.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" class="page-link">Next ‚Ä∫</a>
                <a href="?page={{ videos.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" class="page-link">Last ¬ª</a>
            {% endif %}
        </div>
    {% endif %}
    
{% else %}
    <div class="empty-state">
        <div style="text-align: center; padding: 3rem; color: #666;">
            <h3>No videos found</h3>
            <p>Try adjusting your search or filter criteria.</p>
            <a href="?" class="btn">View All Videos</a>
        </div>
    </div>
{% endif %}

<style>
.video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.video-thumbnail {
    position: relative;
    overflow: hidden;
}

.duration-badge {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8rem;
}

.video-info {
    padding: 1rem;
}

.video-title a {
    color: #333;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.video-title a:hover {
    color: #e74c3c;
}

.channel-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0.75rem 0;
}

.channel-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    object-fit: cover;
}

.channel-name {
    color: #666;
    font-size: 0.9rem;
}

.video-stats {
    display: flex;
    gap: 1rem;
    margin: 0.5rem 0;
    flex-wrap: wrap;
}

.stat {
    color: #666;
    font-size: 0.85rem;
}

.video-badges {
    display: flex;
    gap: 0.5rem;
    margin: 0.5rem 0;
    flex-wrap: wrap;
}

.published-date {
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

@media (max-width: 768px) {
    .video-grid {
        grid-template-columns: 1fr;
    }
    
    .video-stats {
        gap: 0.5rem;
    }
}
</style>
{% endblock %}